.PHONY: clean build package deploy

clean:
	@echo "ğŸ§¹Cleaning"
	rm -f .template.yaml
	rm -rf dist
	rm -rf .webpack
	@echo "ğŸ§¹Cleaningâœ…"

build: clean
	@echo "ğŸ› Building"
	yarn webpack
	@echo skipping "cp -R ./node_modules/ ./.webpack/node_modules"
	@echo "ğŸ› Buildingâœ…"

package: build
	@echo "ğŸ“¦Packaging"
	AWS_DEFAULT_REGION=us-west-2 AWS_PROFILE=ia \
	sam package --template-file template.yaml --s3-bucket s3-ia-cfg --output-template-file .template.yaml
	@echo "ğŸ“¦Packagingâœ…"

deploy: package
	@echo "ğŸ—Deploying"
	AWS_DEFAULT_REGION=us-west-2 AWS_PROFILE=ia \
	sam deploy \
	--stack-name ia-queue-api-qa \
	--template-file .template.yaml \
	--parameter-overrides Env=qa \
	--capabilities CAPABILITY_IAM 
	@echo "ğŸ—Deployingâœ…"

deploy-prod: package
	@echo "âš ï¸PRODUCTIONâš ï¸"
	@echo "ğŸ—Deploying"
	AWS_DEFAULT_REGION=us-west-2 AWS_PROFILE=ia \
	sam deploy \
	--stack-name ia-queue-api-prod \
	--template-file .template.y \
	--parameter-overrides Env=prod \
	--capabilities CAPABILITY_IAM 
	@echo "ğŸ—Deployingâœ…"

	@echo "Don't forget to check the VPC to make sure it didn't get dropped"
